SELECT
  dop.ID_PRIMARY_OPPORTUNITY
  ,DATE_OPPCREATED_DATE
  ,CASE WHEN datediff(day, flc.DATE_MQLDATE, DATE_OPPCREATED_DATE) <= 90 THEN 1 ELSE 0 END AS MQLDate30DaysBeforeOppCreateDate
  ,flc.DATE_MQLDATE
  ,CASE WHEN datediff(day,DATE_LEADCONVERTED,DATE_OPPCREATED_DATE) <=90 THEN 1 ELSE 0 END AS LeadConverted30DaysBeforeOppCreateDate
  ,DATE_LEADCONVERTED
  ,CASE WHEN datediff(day,DATE_MCLDATE,DATE_OPPCREATED_DATE) <=90 THEN 1 ELSE 0 END AS MCLDate30DaysBeforeOppCreateDate
  ,DATE_MCLDATE
  ,CAFix.F_AD_F_ISAUDITISSUEACCEPTED AS Exception_Accepted
  ,F_ISMARKETINGSOURCED
FROM MARKETINGOPERATIONS.DM_CORE.DM_CORE_FACT_OPPORTUNITY_PROD fop
LEFT JOIN MARKETINGOPERATIONS.DM_CORE.DM_CORE_DIM_OPPORTUNITY_PROD dop
ON fop.ID_PRIMARY_OPPORTUNITY = dop.ID_PRIMARY_OPPORTUNITY
LEFT JOIN MARKETINGOPERATIONS.TEMP_TABLES.CA_OPPAUDIT_QUICKFIX CAFix
ON fop.ID_PRIMARY_OPPORTUNITY = CAFix.ID
LEFT JOIN MARKETINGOPERATIONS.DM_CORE.DM_CORE_DIM_LEADCONTACT_PROD dlc
ON fop.ID_LEADCONTACT = dlc.ID_PRIMARY_LEADCONTACT
LEFT JOIN MARKETINGOPERATIONS.DM_CORE.DM_CORE_FACT_LEADCONTACT_PROD flc
ON dlc.ID_PRIMARY_LEADCONTACT = flc.ID_PRIMARY_LEADCONTACT
WHERE dop.DIM_OPPORTUNITYCREATEDBYROLENAME = 'North America - Velocity - Sales AE'
AND YEAR(DATE_OPPCREATED_DATE) = 2019;
