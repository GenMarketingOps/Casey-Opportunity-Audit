DROP VIEW IF EXISTS MARKETINGOPERATIONS.TEMP_TABLES.CA_INVALIDOPPFLAGFIX_Keep;
CREATE VIEW MARKETINGOPERATIONS.TEMP_TABLES.CA_INVALIDOPPFLAGFIX_Keep AS
SELECT
DISTINCT opp.ID
,CASE
    WHEN profile.NAME != 'GEN - MKG - Lead Development Rep'
    AND ((LENGTH(opp.AUTHORITY_COMMENTS_C) < 20 OR opp.AUTHORITY_COMMENTS_C IS NULL)
    OR (LENGTH(opp.NEED_COMMENTS_C) < 20 OR opp.NEED_COMMENTS_C IS NULL)
    OR  (LENGTH(opp.TIMEFRAME_COMMENTS_C) < 20 OR opp.TIMEFRAME_COMMENTS_C IS NULL)) THEN 1 ELSE 0 END AS f_Ad_17_ClaimedOpp
,CASE
    WHEN opp.CONTACT_C IS NULL THEN 1 ELSE 0 END AS f_Ad_01_MissingPrimary

,CASE
    WHEN opp.Lead_Development_Rep_c IS NOT NULL AND opp.Campaign_Source_c IS NULL THEN 1 ELSE 0 END AS f_Ad_03_LDRnoCampaign
,CASE
    WHEN opp.Campaign_Source_c IS NOT NULL AND opp.Lead_Development_Rep_c IS NULL THEN 1 ELSE 0 END AS f_Ad_04_CampaignnoLDR
,CASE
     WHEN (owneruser.IS_ACTIVE = 0 OR ownerprofile.Name ILIKE '%admin%') THEN 1 ELSE 0 END AS f_Ad_08_BadOwner
,CASE
    WHEN ownerprofile.Name ILIKE '%Lead Development%' THEN 1 ELSE 0 END AS f_Ad_09_LDROwned


FROM MARKETINGOPERATIONS.SFDC.OPPORTUNITY opp
left join MARKETINGOPERATIONS.SFDC.user user
ON opp.CREATED_BY_ID = user.ID
left join MARKETINGOPERATIONS.SFDC.PROFILE profile
ON user.PROFILE_ID = profile.ID
LEFT JOIN MARKETINGOPERATIONS.SFDC.USER owneruser
ON opp.OWNER_ID = owneruser.ID
left join MARKETINGOPERATIONS.SFDC.PROFILE ownerprofile
ON owneruser.PROFILE_ID = ownerprofile.ID;
