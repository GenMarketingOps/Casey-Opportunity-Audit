DROP VIEW IF EXISTS MARKETINGOPERATIONS.TEMP_TABLES.CA_OppAudit_QuickFix;
CREATE VIEW MARKETINGOPERATIONS.TEMP_TABLES.CA_OppAudit_QuickFix AS
SELECT
   DISTINCT opp.ID
  ,MAX(CASE WHEN task.Subject ILIKE '%Audit Issue Accepted by Management%' AND PROFILE.Name ILIKE '%Marketing Ops%' THEN 1 ELSE 0 END) AS f_Ad_f_IsAuditIssueAccepted
FROM MARKETINGOPERATIONS.SFDC.OPPORTUNITY opp
LEFT JOIN MARKETINGOPERATIONS.SFDC.TASK task
ON opp.ID = task.WHAT_ID
LEFT JOIN MARKETINGOPERATIONS.SFDC.USER user
ON task.CREATED_BY_ID = user.ID
LEFT JOIN MARKETINGOPERATIONS.SFDC.PROFILE profile
ON user.PROFILE_ID = profile.ID
GROUP BY opp.ID;
